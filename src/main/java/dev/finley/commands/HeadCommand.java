package dev.finley.commands;import dev.finley.HeadPlugin;import dev.finley.util.Printer;import dev.finley.util.builder.InvBuilder;import dev.finley.util.builder.ItemBuilder;import org.bukkit.Bukkit;import org.bukkit.Material;import org.bukkit.command.Command;import org.bukkit.command.CommandExecutor;import org.bukkit.command.CommandSender;import org.bukkit.command.TabExecutor;import org.bukkit.configuration.file.FileConfiguration;import org.bukkit.entity.Player;import org.bukkit.inventory.ItemStack;import org.jetbrains.annotations.NotNull;import org.jetbrains.annotations.Nullable;import java.util.ArrayList;import java.util.List;public class HeadCommand implements CommandExecutor, TabExecutor {    private final FileConfiguration configFile = HeadPlugin.getInstance().getConfig();    private final FileConfiguration messageFile = HeadPlugin.getInstance().getMessageFile();    @Override    public boolean onCommand(@NotNull CommandSender sender, @NotNull Command cmd, @NotNull String label, @NotNull String @NotNull [] args) {        if (!(sender instanceof Player player)) {            //TODO -> command working for console too            return true;        }        if (!player.hasPermission(Printer.getString(configFile, "permissions.useCommand"))) {            Printer.sendPlayerMessage(player, "error.noPermission");            return false;        }        if (args.length < 1) {            Printer.sendPlayerMessage(player, "usage.message", true, "%command%!_!" + "§8/§7" + label);            return false;        }        if (args.length < 2) {            if (args[0].equalsIgnoreCase(getArgument(1))) { //gui                InvBuilder builder = new InvBuilder(Printer.getString(messageFile, "gui.settings.name", true), 45);                builder.setItemToAll(new ItemBuilder(Material.BLACK_STAINED_GLASS_PANE).setEmptyName("d").build());                ItemStack languageItem = new ItemBuilder(Material.PLAYER_HEAD).setName(Printer.getString(messageFile, "gui.settings.items.languageItem.name", true)).setLore(Printer.getString(messageFile, "gui.settings.items.languageItem.description", true)).setHead(messageFile.getString("languageHeads." + HeadPlugin.getInstance().getLanguageManager().getSelectedLanguage())).build();                builder.setItem(languageItem, 13);                ItemStack configItem = new ItemBuilder(Material.PAPER).setName(Printer.getString(messageFile, "gui.config.items.configItem", true)).build();                builder.setItem(configItem, 20);                player.openInventory(builder.getInventory());                return true;            }            Printer.sendPlayerMessage(player, "usage.message", true, "%command%!_!" + "§8/§7" + label);            return false;        } else if (args.length < 3) {            if (args[0].equalsIgnoreCase(getArgument(0))) { //give                String headName = args[1];                player.getInventory().addItem(new ItemBuilder(Material.PLAYER_HEAD).setName("§a" + headName).setUserNameHead(headName).build());                Printer.sendPlayerMessage(player, "success.gaveHead.self", "%head%!_!" + headName);            } else {                if (args[0].equalsIgnoreCase(getArgument(2))) { //language                    String language = args[1];                    if (language.isBlank()) {                        Printer.sendPlayerMessage(player, "usage.message", true, "%command%!_!" + "§8/§7" + label);                        return false;                    }                    String old = HeadPlugin.getInstance().getLanguageManager().getSelectedLanguage();                    if (old.equalsIgnoreCase(language)) {                        Printer.sendPlayerMessage(player, "error.language.already");                        return false;                    }                    HeadPlugin.getInstance().getLanguageManager().setSelectedLanguage(language);                    HeadPlugin.getInstance().getConfig().set("settings.language", HeadPlugin.getInstance().getLanguageManager().getSelectedLanguage());                    HeadPlugin.getInstance().saveConfig();                    Printer.sendPlayerMessage(player, "success.language.set", "%old%!_!&c" + messageFile.getString(old + ".name") + "&7", "%language%!_!&a" + messageFile.getString(HeadPlugin.getInstance().getLanguageManager().getSelectedLanguage() + ".name") + "&7");                }            }        } else if (args.length < 4) {            Player target = Bukkit.getPlayer(args[2]);            if (target == null) {                Printer.sendPlayerMessage(player, "error.playerNotFound");                return false;            }            String headName = args[1];            target.getInventory().addItem(new ItemBuilder(Material.PLAYER_HEAD).setName("§a" + headName).setUserNameHead(headName).build());            Printer.sendPlayerMessage(player, "success.gaveHead.target", "%head%!_!" + headName);            Printer.sendPlayerMessage(target, "success.gaveHead.self", "%head%!_!" + headName);            return true;        }        return true;    }    @Override    public @Nullable List<String> onTabComplete(@NotNull CommandSender sender, @NotNull Command cmd, @NotNull String label, @NotNull String @NotNull [] args) {        List<String> list = new ArrayList<>();        if (!sender.hasPermission(Printer.getString(configFile, "permissions.useCommand"))) return list;        switch (args.length) {            case 1 -> {                boolean needTranslate = messageFile.getBoolean("settings.translateUsage");                String defaultTranslateKey = messageFile.getString("settings.defaultUsageLanguage");                if (defaultTranslateKey == null || defaultTranslateKey.isBlank()) defaultTranslateKey = "en";                list = (needTranslate ? messageFile.getStringList(HeadPlugin.getInstance().getLanguageManager().getSelectedLanguage() + ".usage.usages") : messageFile.getStringList(defaultTranslateKey + ".usage.usages"));            }            case 2 -> {                if (args[0].equalsIgnoreCase(getArgument(0))) {                    list = Bukkit.getOnlinePlayers().stream().map(Player::getName).toList();                } else {                    if (args[0].equalsIgnoreCase(getArgument(2))) {                        list = HeadPlugin.getInstance().getLanguageManager().getLanguages();                    }                }            }            case 3 -> {                if (args[0].equalsIgnoreCase(getArgument(0))) {                    list = Bukkit.getOnlinePlayers().stream().map(Player::getName).toList();                }            }        }        list = list.parallelStream().filter(string -> string.startsWith(args[args.length - 1])).toList();        return list;    }    private String getArgument(int index) {        boolean needTranslate = messageFile.getBoolean("settings.translateUsage");        String defaultTranslateKey = messageFile.getString("settings.defaultUsageLanguage");        if (defaultTranslateKey == null || defaultTranslateKey.isBlank()) defaultTranslateKey = "en";        return (needTranslate ? messageFile.getStringList(HeadPlugin.getInstance().getLanguageManager().getSelectedLanguage() + ".usage.usages").get(index) : messageFile.getStringList(defaultTranslateKey + ".usage.usages").get(index));    }}